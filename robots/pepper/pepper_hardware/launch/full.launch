<?xml version="1.0"?>
<launch>

    <arg name="debug" default="false" />

    <arg name="ip" default="pepper.local" />
    <arg name="port" default="9559" />

    <param name="robot_description" command="xacro --inorder $(find pepper_description)/urdf/pepper1.0_generated_urdf/pepper_robot.xacro" />
    <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" />

    <node name="autonomous_life_disabler" pkg="pepper_hardware" type="autonomous_life_disabler" required="true">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
    </node>

    <node name="base_controller" pkg="pepper_hardware" type="base_controller" required="true">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
    </node>
    <node name="body_controller" pkg="pepper_hardware" type="body_controller" required="true">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
    </node>
    <include file="$(find pepper_hardware)/launch/hmi.launch">
        <arg name="ip" value="$(arg ip)" />
        <arg name="port" value="$(arg port)" />
    </include>
    <node name="battery_status" pkg="pepper_hardware" type="battery_status" required="true">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
    </node>
    <node name="sound_source_localization" pkg="pepper_hardware" type="sound_source_localization" required="true">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
    </node>

    <node name="camera" pkg="pepper_hardware" type="camera" required="true" ns="camera_top">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
        <param name="camera_index" value="0" />
        <param name="encoding" value="bgr8" />
        <param name="resolution" value="640x480" />
        <param name="frame_id" value="CameraTop_optical_frame" />
        <param name="name" value="camera_top" />
        <param name="camera_info_url" value="file://$(find pepper_hardware)/share/camera_top_640x480.yaml" />
    </node>
    <node name="camera" pkg="pepper_hardware" type="camera" required="true" ns="camera_bottom">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
        <param name="camera_index" value="1" />
        <param name="encoding" value="bgr8" />
        <param name="resolution" value="640x480" />
        <param name="frame_id" value="CameraBottom_optical_frame" />
        <param name="name" value="camera_bottom" />
        <param name="camera_info_url" value="file://$(find pepper_hardware)/share/camera_bottom_640x480.yaml" />
    </node>

    <node name="camera" pkg="pepper_hardware" type="camera" required="true" ns="camera_depth">
        <param name="ip" value="$(arg ip)" />
        <param name="port" value="$(arg port)" />
        <param name="camera_index" value="2" />
        <param name="encoding" value="16UC1" />
        <param name="resolution" value="320x240" />
        <param name="frame_id" value="CameraDepth_optical_frame" />
        <param name="name" value="camera_depth" />
        <param name="camera_info_url" value="file://$(find pepper_hardware)/share/camera_depth_320x240.yaml" />
    </node>

    <node pkg="nodelet" type="nodelet" name="camera_nodelet_manager"  args="manager"/>
    <node pkg="nodelet" type="nodelet" name="depth_registration" args="load depth_image_proc/register camera_nodelet_manager">
        <remap from="rgb" to="camera_top" />
        <remap from="depth/camera_info" to="camera_depth/camera_info" />
        <remap from="depth/image_rect" to="camera_depth/image" /> <!-- TODO: rectify image -->
        <remap from="depth_registered" to="camera_depth_registered_to_camera_top" />
    </node>

 </launch>
